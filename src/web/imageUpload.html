<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
    </head>
    <body>
        <!-- ################ -->
        <!-- # 사진 자동 업로드 # -->
        <!-- # 전송 버튼 없어요 # -->
        <!-- ################ -->

        <!-- 사진 preview AND Drag & Drop -->
        <img id="preview" src="" width="500" height="500" alt=""/>

        <div>
                <!-- 사진 선택 -->
                <input type="file" name="upload" id="getfile">
                <button
                    style="color:black ; background:white; font-size:2em; border-radius:0.5em; padding:5px 20px;"
                    onclick="location.href='showResult.html'">
                 결과 보기</button>
        </div>

        <!-- 사진 선택 시 선택한 사진 화면에 출력 -->
        <script type="text/javascript">
            // file: 파일 선택으로 가져온 사진
            var file = document.querySelector('#getfile');

            // 파일 선택 처리
            file.onchange = function () {
                var files = file.files ;
                readfiles(files)
            };

            // drag: Drag & Drop으로 가져온 사진
            var drag = document.getElementById('preview');

            // Drag & Drop 처리
            drag.ondragover = function () { this.className = 'hover'; return false;}
            drag.ondragend = function () { this.className = ''; return false;}
            drag.ondrop = function(e) {
                this.className = '';
                e.preventDefault();
                readfiles(e.dataTransfer.files);
            }

            // 파일 화면에 출력 -> 업로드
            function readfiles(files) {
                var reader = new FileReader();
                reader.readAsDataURL(files[0]);
                reader.onload = function () {
                    document.querySelector('#preview').src = reader.result;
                }
                send(files)
            }

            // 사진 업로드
            function send(files) {
                var formData = new FormData();
                formData.append('upload', files[0]);

                var xhr = new XMLHttpRequest();
                xhr.open('POST', 'upload.php');
                xhr.send(formData);
            }
        </script>
    </body>
</html>
